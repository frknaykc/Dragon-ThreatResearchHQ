================================================================================
                    ETHERRAT MALWARE - TECHNICAL ANALYSIS
================================================================================

################################################################################
                          EXECUTIVE SUMMARY
################################################################################

EtherRAT, JavaScript tabanlı bir RAT/implant olup hem Linux hem de Windows 
sistemlerini hedefler. İlk olarak Sysdig tarafından belgelenmiş ve React2Shell 
zafiyeti (CVE-2025-55182) üzerinden dağıtıldığı gözlemlenmiştir.

Öne Çıkan Özellikler:
  - Blockchain tabanlı C2 çözümlemesi (Ethereum smart contracts)
  - MSI dosyaları olarak dağıtılır (oyun modları olarak gizlenir)
  - Tsundere Botnet ile infrastructure overlap
  - 12 aktif Ethereum smart contract kullanımı
  - Dinamik C2 adres çözümlemesi (9 farklı Ethereum RPC endpoint)
  - Sürekli geliştiriliyor (yeni özellikler ekleniyor)

Hedef Platformlar:
  - Windows (MSI, PowerShell, JavaScript)
  - Linux (Shell scripts, JavaScript)

Dağıtım Yöntemi:
  - Sahte oyun mod installer'ları ("99 Nights Script", GTA Online mods)
  - React2Shell vulnerability (CVE-2025-55182)
  - MSI/PowerShell/Shell script packages

================================================================================
                          ATTACK FLOW ANALİZİ
================================================================================

Saldırı Zinciri (Windows Variant):

1. Initial Access:
   └─> 99 Nights Script.zip (Archive file)
       └─> 99 Nights Script Installer.msi
           └─> Creates 3 files in %LOCALAPPDATA%\msitemp:
               ├─> syBKJQiN.cmd (Batch script - downloads Node.js)
               ├─> Dt2fWrOyPtRxL28.js (Obfuscated JS decryptor)
               └─> IEgrjQr6OI6C3pf (Encrypted EtherRAT payload)

2. Execution:
   └─> MSI CustomAction triggers syBKJQiN.cmd
       └─> Downloads Node.js to %LOCALAPPDATA%\6gahPD
       └─> Copies JS files to same directory
       └─> Executes Dt2fWrOyPtRxL28.js

3. Decryption:
   └─> Dt2fWrOyPtRxL28.js (obfuscator.io)
       ├─> Anti-Analysis Techniques:
       │   ├─> Console output suppression
       │   └─> Formatting detection (beautify check)
       ├─> AES-256-CBC decryption
       └─> Saves as f6gK5600n6.js
       └─> Establishes persistence (Registry Run key → areAx6ey.js)

4. Payload Execution:
   └─> f6gK5600n6.js (EtherRAT Main Payload)
       ├─> Creates log file: %APPDATA%\svchost.log
       ├─> Queries Ethereum smart contracts for C2 address
       ├─> Generates unique system ID
       ├─> Creates configuration file (path based on system hash)
       └─> Connects to C2 and awaits commands

================================================================================
                    TECHNICAL CAPABILITIES
================================================================================

1. BLOCKCHAIN-BASED C2 RESOLUTION
   ━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━

   EtherRAT, C2 adresini hardcode etmez. Bunun yerine Ethereum smart 
   contract'lardan dinamik olarak alır.

   Method: eth_call
   Function Signature: 0x7d434425 (getString(address))
   Data: Contract address + Wallet address

   Kullanılan Ethereum RPC Endpoints (9 adet, concurrent):
     1. https://eth.llamarpc.com
     2. https://mainnet.gateway.tenderly.co
     3. https://rpc.flashbots.net/fast
     4. https://rpc.mevblocker.io
     5. https://eth-mainnet.public.blastapi.io
     6. https://ethereum-rpc.publicnode.com
     7. https://rpc.payload.de
     8. https://eth.drpc.org
     9. https://eth.merkle.io

   Malware, tüm endpoint'lere eşzamanlı sorgu gönderir ve en çok dönen 
   URL'yi C2 adresi olarak seçer.

2. CONFIGURATION FILE MANAGEMENT
   ━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━

   Path Generation Algorithm:
   └─> MD5(Computer Name + User Name)
       ├─> First byte % 5 → Parent folder:
       │   0: Microsoft | 1: Windows | 2: Programs | 3: Package | 4: Google
       ├─> Second byte % 5 → Subfolder:
       │   0: Services | 1: Components | 2: Assemblies | 3: Extensions | 4: Modules
       └─> Path:
           ├─> %LOCALAPPDATA%\[Folder]\[Subfolder]\[Hash_First_4_Bytes]
           └─> Fallback: %LOCALAPPDATA%\[Folder]\[Hash_First_8_Bytes]

   Config filename: First 6 bytes of folder path hash
   Format: Base64-encoded JSON

   Config Structure (indices):
     [0] → Unique ID
     [1] → Connection status to reobf endpoint
     [3] → Connection time to reobf endpoint
     [5] → Log file writing status

3. ID GENERATION
   ━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━

   ID Search Priority:
     1. Configuration file (index 0)
     2. .node_bot_id file
     3. File matching pattern: "." prefix, 11 characters long
     4. Generate new ID: crypto.randomUUID() → save to config

4. C2 COMMUNICATION
   ━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━

   Traffic Obfuscation:
   └─> Random extension: png, jpg, gif, css, ico, webp
   └─> Random variable name: id, token, key, b, q, s, v

   Request Format:
   POST [C2]/api/[RandomHex]/[ID]/[RandomHex].[Extension]?[Variable]=5a15c932-4675-4a53-920d-3f3a7aa2e835

   Response: JavaScript code (executed by malware)
   Retry: ~3 seconds if no response

5. PERSISTENCE
   ━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━

   Windows:
     └─> Registry Run Key → areAx6ey.js (decryptor script)

   Linux (5 methods):
     1. systemd user service
     2. XDG autostart entry
     3. Cron job
     4. .bashrc injection
     5. .profile injection

6. ANTI-ANALYSIS TECHNIQUES
   ━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━

   Obfuscation: obfuscator.io
   
   Protection Mechanisms:
     1. Console Output Suppression (log analysis engelleme)
     2. Formatting Detection (beautify check → dummy code execution)
     3. AES-256-CBC encryption (payload)

================================================================================
                    LINUX vs WINDOWS VARIANTS
================================================================================

┌─────────────────────┬──────────────────────────┬──────────────────────────┐
│ Feature             │ Linux EtherRAT           │ Windows EtherRAT         │
├─────────────────────┼──────────────────────────┼──────────────────────────┤
│ Ethereum Contract   │ Yes (dynamic C2)         │ Mixed:                   │
│ Usage               │                          │ - Some use contracts     │
│                     │                          │ - Some hardcode C2       │
├─────────────────────┼──────────────────────────┼──────────────────────────┤
│ Persistence         │ 5 methods:               │ Registry Run Key         │
│                     │ - systemd service        │ (handled by decryptor)   │
│                     │ - XDG autostart          │                          │
│                     │ - Cron job               │                          │
│                     │ - .bashrc injection      │                          │
│                     │ - .profile injection     │                          │
├─────────────────────┼──────────────────────────┼──────────────────────────┤
│ Build Value         │ c6d83cb1-a4de-443d-      │ 5a15c932-4675-4a53-      │
│                     │ bd78-da925acc5f8d        │ 920d-3f3a7aa2e835        │
│                     │ (No logging)             │ (With logging)           │
├─────────────────────┼──────────────────────────┼──────────────────────────┤
│ Contract Address    │ 0x22f96D61cF118efaBC7... │ 0x429929d8fe40D2deCf6... │
│                     │                          │ (or hardcoded C2)        │
├─────────────────────┼──────────────────────────┼──────────────────────────┤
│ Distribution        │ React2Shell exploit      │ MSI files (game mods)    │
│                     │ (CVE-2025-55182)         │                          │
└─────────────────────┴──────────────────────────┴──────────────────────────┘

Hardcoded C2 (some Windows variants):
  └─> Contract address: 0x0000000000000000000000000000000000000000
  └─> Wallet address: 0x0000000000000000000000000000000000000000
  └─> C2 URL: hxxp://91.215[.]85.42:3000

================================================================================
                    SMART CONTRACT ANALYSIS
================================================================================

1. IDENTIFIED CONTRACTS (12 total)
   ━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━

   All contracts share identical bytecode:
     - 0x22f96D61cF118efaBC7C5bF3384734FaD2f6eaD4
     - 0x429929d8fe40D2deCf618C4A87721AC2a820bA78
     - 0x195ab0A6391E2c499321F67Ba36ED8f4bDc9F5f4
     - 0x21F9a727E9668A3fC30393a344D8a3A98F4F3b8d
     - 0x277852e1C349b03c79E348018a8391bD21C412E8
     - 0x40A7d723F5Df6c88464bC95DBf7D96573fBc4f85
     - 0x47A397D9d459B05433f0d579e7842442b348eC38
     - 0x6ef160dAC69c68461879c0C3486164aF07533d17 (Earliest: 2025-11-29)
     - 0x8a7c8497991dEa66910E70979a5961aEE347ff50
     - 0x8B08cE78a284F26eEDfE2b9B52823F8c6ab3dC4A
     - 0x97851AE6B1e2970C030Dd7d8F70d9832AcfB30fd
     - 0xF1f3Ac96E49F6a71D031444E59268c27B3511914

2. WALLET ADDRESSES (13 total)
   ━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━

   Contract Creator Wallets:
     - 0x69A91686482dE1dF123b91106CbdA763da034d4A
     - 0xE941A9b283006F5163EE6B01c1f23AA5951c4C8D
     - 0x233F7Ac7F307D2c781be66DA432CB865Efa804e0
     - 0x6c0bdC011F31715C4FF537aa9c6a8A141F8a6119
     - 0x14afdDD627Fb0e039365554f8bbDB881eCb1C708
     - 0x434A2001adD7e414dA33612C4a8AEe745EA22968
     - 0x4F1dD066b832AF641b5F08537a5b0fC0b329D5EC
     - 0x2EB2Ec6026B63158042d27e8004957EC71783287
     - 0xeA4337aa83496F0b91CDCdD8bf2734DF9eEF1774
     - 0x6d4C034439F78cc19b4FEBdeC2c285D9B7D47e73
     - 0xF1933D62F03F56579E8362402316CBF450d30116
     - 0xF3947eeB5DB984E9498DA449c13305ed27428Bc0

   Funding Wallet (Phishing Activity Reported):
     - 0x69de85F382B7855c55df3092aE36BBf75eF1f6CD
       └─> Funded 3 attacker wallets 66 days after last activity
       └─> Reported for phishing on HashDit

3. CONTRACT FUNCTIONS
   ━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━

   Common Functions (Method IDs):
     - getString(address): 0x7d434425
     - setString(strings): 0x7fcaf666

   Note: These functions are shared with Tsundere Botnet contracts.

4. C2 HISTORY FROM TRANSACTION RECORDS
   ━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━

   From EtherRAT Active Contracts:
     - hxxp://91.215.85[.]42:3000 (Russian bulletproof hosting)
     - hxxp://173.249.8[.]102 (Contabo VPS)
     - hxxps://grabify[.]link/SEFKGU (IP tracking service)
     - hxxps://gateway001kir[.]com (Cloudflare protected)
     - hxxp://91.221.190[.]12 (BlueVPS)

   From Additional Contracts:
     - hxxps://api-gateway-prod[.]com (BlueVPS)
     - hxxp://localhost:3000 (Testing)
     - hxxps://jariosos[.]com (Registered 2025-12-17)
     - hxxps://api-gateway-softupdate[.]io (Registered 2025-12-19)

================================================================================
                    TSUNDERE BOTNET CONNECTION
================================================================================

Infrastructure Overlap:
  └─> 91.215.85[.]42 hosts both:
      ├─> EtherRAT C2 server
      └─> Tsundere Reborn control panel
      └─> 123 Stealer C2 panel

Smart Contract Similarities:
  ┌─────────────────┬───────────────┬───────────────────────────────┐
  │ Function        │ Method ID     │ Description                   │
  ├─────────────────┼───────────────┼───────────────────────────────┤
  │ getString       │ 0x7d434425    │ Retrieves C2 address          │
  │ setString       │ 0x7fcaf666    │ Stores C2 address             │
  └─────────────────┴───────────────┴───────────────────────────────┘

  Note: Identical function IDs and operational logic despite different bytecode.

Tsundere Reborn Control Panel Features:
  - Dashboard (Bot statistics)
  - Bots (Detailed bot list)
  - Builds (MSI, PowerShell, Linux payload generator)
  - Workers (Account delegation)
  - Scanner (Vulnerability scanning & credential harvesting)
  - Auto Tasks (Scheduled JavaScript execution)
  - SOCKS5 Proxies (Proxy server configuration)
  - Web3 Configuration (Smart contract management)
  - Settings (Account management)

Evidence of Russian Attribution:
  - Russian comments in Tsundere Botnet code
  - Russian strings in malware
  - Russian bulletproof hosting usage

================================================================================
                    INFRASTRUCTURE ANALYSIS
================================================================================

C2 Servers:
  91.215.85[.]42       → Russian bulletproof hosting (Primary)
  173.249.8[.]102      → Contabo VPS (Germany)
  91.221.190[.]12      → BlueVPS (Russia)
  gateway001kir[.]com  → Cloudflare protected
  api-gateway-prod[.]com                → BlueVPS
  jariosos[.]com                        → New registration (2025-12-17)
  api-gateway-softupdate[.]io           → New registration (2025-12-19)

Third-party Services:
  grabify[.]link       → IP/device info tracking service
  localhost:3000       → Testing environment

Timeline:
  2025-11-29 → Earliest contract created (0x6ef160dAC69c68461879c0C3486164aF07533d17)
             → Predates CVE-2025-55182 public disclosure
  2025-12-17 → jariosos[.]com registered
  2025-12-19 → api-gateway-softupdate[.]io registered
  Present    → 12 active smart contracts, actively evolving

================================================================================
                    MITRE ATT&CK MAPPING
================================================================================

Execution:
  - T1204.002: User Execution: Malicious File
  - T1059.003: Command and Scripting Interpreter: Windows Command Shell
  - T1059.007: Command and Scripting Interpreter: JavaScript

Defense Evasion:
  - T1036: Masquerading
  - T1140: Deobfuscate/Decode Files or Information
  - T1027.013: Obfuscated Files or Information: Encrypted/Encoded File
  - T1027.016: Obfuscated Files or Information: Junk Code Insertion
  - T1564.003: Hide Artifacts: Hidden Window
  - T1112: Modify Registry

Persistence:
  - T1547.001: Boot or Logon Autostart Execution: Registry Run Keys / Startup Folder

Discovery:
  - T1033: System Owner/User Discovery
  - T1083: File and Directory Discovery

Command and Control:
  - T1105: Ingress Tool Transfer
  - T1102.001: Web Service: Dead Drop Resolver
  - T1071.001: Application Layer Protocol: Web Protocols
  - T1571: Non-Standard Port

================================================================================
                    KEY TAKEAWAYS
================================================================================

1. BLOCKCHAIN ABUSE
   └─> EtherRAT pioneered blockchain-based C2 resolution, making 
       infrastructure takedown significantly more difficult.

2. RAPID EVOLUTION
   └─> Discovered < 1 month ago, already:
       - Multi-platform support (Linux + Windows)
       - New features (logging, improved persistence)
       - 12 active smart contracts

3. SOPHISTICATED INFRASTRUCTURE
   └─> Bulletproof hosting, Cloudflare protection, legitimate VPS providers
   └─> Connection to established botnets (Tsundere, 123 Stealer)

4. TARGETING GAMERS
   └─> Social engineering via fake game mod installers
   └─> "99 Nights Script", GTA Online mods

5. IMMUTABLE IOCs
   └─> Blockchain transaction history provides permanent IOC record
   └─> All historical C2 addresses recoverable

6. OPERATIONAL SECURITY
   └─> Separate wallets for each contract
   └─> Gas fee funding via dedicated wallet
   └─> No unnecessary blockchain activity
